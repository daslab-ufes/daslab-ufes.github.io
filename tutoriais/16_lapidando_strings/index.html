<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pedro de Brito Neto">
<meta name="description" content="A manipulação eficaz de dados frequentemente envolve lidar com strings, que consistem em letras, símbolos e números representando informações escritas. Descubra como abordar strings utilizando o R.">

<title>Lapidando strings</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<link href="../..//img/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(banner.png);
background-size: cover;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/daslab-logo-removebg.png" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Alternar de navegação" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../sobre/index.html"> 
<span class="menu-text">Sobre</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projetos/index.html"> 
<span class="menu-text">Projetos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutoriais/index.html"> 
<span class="menu-text">Tutoriais</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ensinar/index.html"> 
<span class="menu-text">ensinaR</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../oobr/index.html"> 
<span class="menu-text">OOBr</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../eventos/index.html"> 
<span class="menu-text">Eventos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contato/index.html"> 
<span class="menu-text">Contato</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Lapidando strings</h1>
                  <div>
        <div class="description">
          A manipulação eficaz de dados frequentemente envolve lidar com strings, que consistem em letras, símbolos e números representando informações escritas. Descubra como abordar strings utilizando o R.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Data Wrangling</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Análise de Dados</div>
                <div class="quarto-category">Programação</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor</div>
      <div class="quarto-title-meta-contents">
               <p>Pedro de Brito Neto </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Data de Publicação</div>
      <div class="quarto-title-meta-contents">
        <p class="date">1 de julho de 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<style>
body {
    background: white;
}

.quarto-title-banner{
    text-align: left !important;
}
</style>
<p>Um desafio muito grande na manipulação de dados é extrair informações de caracteres. Em resumo caracteres são letras, símbolos, sinais, números que representem algo escrito, etc.. Essa sequência de caracteres formam o que chamamos de <code>string</code>. Diversas vezes encontramos variáveis com categorias não padronizadas, como, por exemplo, uma variável contendo “São Paulo”, “sao paulo” e “sp”. Apesar de representarem o mesmo estado, elas são diferentes. Nesse sentido, uma parte muito importante no tratamento de dados é “lapidar” esse conjunto de caracteres para que seja possível usá-los nas análises.</p>
<p>Algumas tarefas relacionadas a string’s podem ser listadas, como:</p>
<ul>
<li>Detectar: “tem ou não tem?”</li>
<li>Localizar: “qual a posição deste elemento?”</li>
<li>Extrair: selecionar a parte que nos interessa.</li>
<li>Substituir: fazer mudanças e correções.</li>
</ul>
<p>Uma das principais soluções para isso é fazer o uso de funções e expressões regulares, do inglês <em>regular expressions</em> (Regex). O proprio R possui algumas funções que nos ajudam a trabalhar com string’s. Porém, o pacote <code>stringr</code> pertencente ao universo <code>tidyverse</code> deixa essas (e outras) funções de uma maneira muito mais intuitiva de ser utilizada.</p>
<p>Vamos primeiro mostrar algumas funções básicas do pacote que podem nos auxiliar nessa manipulação de caracteres e depois falaremos sobre as expressões regulares. Com um breve conhecimento em ambas as partes (funções e Regex), podemos juntá-las e com isso tornar nossas análises muito mais fáceis.</p>
<p>Para usar o pacote podemos importá-lo diretamente ou através do tidyverse. Para o post vamos carregar o tidyverse pois iremos utilizar algumas funções de outros pacotes. Vale lembrar que já fizemos um post sobre o <code>tidyverse</code> e você pode acessá-lo clicando <a href="https://daslab-ufes.github.io/tidyverse/">aqui</a>.</p>
<!-- que em resumo são letras, símbolos, sinais, número que representa algo escrito, etc.. Esses -->
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># carregando o stringr através do tidyverse</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="str_length" class="level3">
<h3 class="anchored" data-anchor-id="str_length"><code>str_length</code></h3>
<p>A primeira função que vamos falar é a <code>str_length</code>. Essa é uma função bem simples do <code>stringr</code> que tem como objetivo fornecer o número de caracteres de uma string, ou seja, o comprimento da string (não confunda com o <code>length()</code> de um vetor). Uma observação é que para valores <code>NA</code> ela irá retornar <code>NA</code>, ao invés de contar o número de caracteres na string <code>NA</code>. Vamos a um exemplo</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ex_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tamanho"</span>, <span class="st">"das"</span>, <span class="st">"palavras"</span>, <span class="st">"com"</span>, <span class="st">"str_length"</span>, <span class="cn">NA</span>, <span class="st">"3"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(ex_1)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>7</td>
<td>3</td>
<td>8</td>
<td>3</td>
<td>10</td>
<td>NA</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="str_sub" class="level3">
<h3 class="anchored" data-anchor-id="str_sub"><code>str_sub</code></h3>
<p>É comum você precisar pegar partes fixas de strings, como apenas a parte final das strings ou apenas os 2 primeiros caracteres. Essa função possui 5 argumentos, os quais podem ser obtidos utilizando o help do R (rodar <code>?str_sub</code> no console). Os três primeiros argumentos são em geral os mais utilizados. O primeiro irá receber um vetor de caracteres, o objeto no qual a função irá fazer as buscas. O segundo <code>start</code> você indica onde irá começar e o argumento <code>end</code> indica até onde ir na busca. Para este exemplo em particular vamos criar uma vetor mais organizado para ficar mais claro.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vamos criar um vetor de caracteres padronizando "nome-idade"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ex_sub <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"João-42"</span>, <span class="st">"Maria-29"</span>, <span class="st">"Pedro-20"</span>, <span class="st">"Tereza-50"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Primeiro vamos supor que a gente queira pegar apenas os nomes. Como nesse caso os caracteres possuem tamanhos diferentes para os nomes, mas a idade possui dois dígitos para todos. Uma característica interessante do <code>str_sub()</code> é sua capacidade de trabalhar com índices negativos nas posições start e end. Quando usamos uma posição negativa, str_sub() conta regressivamente a partir do último caracter:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(ex_sub, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“João”</td>
<td>“Maria”</td>
<td>“Pedro”</td>
<td>“Tereza”</td>
</tr>
</tbody>
</table>
</div>
<p>Caso a gente queira pegar apenas as idade podemos utilizar o argumento <code>start</code> para indicar onde iremos começar.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># neste caso iremos pegar do penultimo caractere até o último</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(ex_sub, <span class="at">start =</span> <span class="sc">-</span><span class="dv">2</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“42”</td>
<td>“29”</td>
<td>“20”</td>
<td>“50”</td>
</tr>
</tbody>
</table>
</div>
<p>Também é possível utilizar o <code>start</code> e o <code>end</code> em conjunto.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estamos pegando valores da posição 3 até a posição 4.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ex_sub2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"__SP__"</span>, <span class="st">"__MG__"</span>, <span class="st">"__RJ__"</span>, <span class="st">"__ES__"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(ex_sub2, <span class="dv">3</span>, <span class="dv">4</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“SP”</td>
<td>“MG”</td>
<td>“RJ”</td>
<td>“ES”</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="str_trim" class="level3">
<h3 class="anchored" data-anchor-id="str_trim"><code>str_trim</code></h3>
<p>Dentro de um conjunto de dados é comum que a gente encontre textos com espaços a mais ou em lugares que não deveriam ter espaços. Espaços antes e após o texto são especialmente chatos, pois pode ser difícil detectá-los. Isso pode acontecer principalmente quando estamos tratando de dados provenientes de formulários que contém respostas abertas, ou seja, cada usuário pode escrever da forma que preferir. Isso pode gerar alguns problemas, como criar categorias diferentes para valores que deveriam ser iguais. A função <code>str_trim</code> pode nos auxiliar na resolução desse problema removendo os espaços excedentes antes e depois da string. Os argumentos da função são dois: o objeto , e <code>side</code>, onde você indica o lado que deseja tirar os espaços, com as opções <code>side = c("both", "left", "right"))</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>extrim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">" vetor"</span>, <span class="st">" para "</span>, <span class="st">"exemplificar"</span>, <span class="st">"o uso"</span>, <span class="st">"  da função  "</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(extrim, <span class="at">side =</span> <span class="st">"left"</span>) <span class="co"># removendo espaçoes excedentes à esquerda</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 26%">
<col style="width: 16%">
<col style="width: 18%">
</colgroup>
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“vetor”</td>
<td>“para”</td>
<td>“exemplificar”</td>
<td>“o uso”</td>
<td>“da função”</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(extrim, <span class="at">side =</span> <span class="st">"right"</span>) <span class="co"># removendo espaçoes excedentes à direita</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 26%">
<col style="width: 16%">
<col style="width: 18%">
</colgroup>
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“vetor”</td>
<td>” para”</td>
<td>“exemplificar”</td>
<td>“o uso”</td>
<td>” da função”</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(extrim, <span class="at">side =</span> <span class="st">"both"</span>) <span class="co"># removendo espaçoes excedentes em ambos os lados</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 26%">
<col style="width: 16%">
<col style="width: 18%">
</colgroup>
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“vetor”</td>
<td>“para”</td>
<td>“exemplificar”</td>
<td>“o uso”</td>
<td>“da função”</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="str_detect-e-str_which" class="level3">
<h3 class="anchored" data-anchor-id="str_detect-e-str_which"><code>str_detect</code> e <code>str_which</code></h3>
<p>Caso a gente queira detectar alguma característica dentro de um vetor como números, letras ou palavras por exemplo, poderíamos fazer o uso da função <code>str_detect</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># criando um vetor</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>altura <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1.85"</span>, <span class="st">"1 metro e 60 centimetros"</span>, <span class="st">"191 cm"</span>, <span class="st">"167"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1,58 metros"</span>, <span class="st">"188"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Como dito antes, iremos utilizar algumas outras funções e uma delas é o operador pipe (<code>%&gt;%</code>). No post sobre <a href="https://daslab-ufes.github.io/tidyverse/"><code>tidyverse</code></a> ensinamos a usar esse operador.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aqui ele retorna um vetor booleano com valores "TRUE"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># caso o caractere contenha o "8" e "FALSO" caso contrário.</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>altura <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">"8"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>TRUE</td>
<td>FALSE</td>
<td>FALSE</td>
<td>FALSE</td>
<td>TRUE</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Também é possível utilizar operadores lógicos</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>altura <span class="sc">%&gt;%</span> <span class="fu">str_detect</span>(<span class="st">"cm|centimetro"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>FALSE</td>
<td>TRUE</td>
<td>TRUE</td>
<td>FALSE</td>
<td>FALSE</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
</div>
<p>Note que na segunda vez que utilizamos função, escrevemos “centimetro” e o vetor retornou um <code>TRUE</code> na posição dois, entretando ela está no plural (centimetros). É exatamento isso que a função faz: ela não está buscando toda a palavra, ela busca padrões, qualquer string que tiver, nesse caso, “centimetro” ele irá retornar o valor <code>TRUE</code>. Neste mesmo conceito, existe a função <code>str_which</code> que no lugar de retornar um vetor booleano, ela retorna as posições no vetor em que a string buscada foi encontrada.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>altura <span class="sc">%&gt;%</span> <span class="fu">str_which</span>(<span class="st">"cm|centimetro"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>2</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="str_subset" class="level3">
<h3 class="anchored" data-anchor-id="str_subset"><code>str_subset</code></h3>
<p>Digamos agora que a gente queira não só detectar essas características (números, pontuação, letras), mas utilizá-las. A função <code>str_subset()</code> retorna essas strings compatíveis com as características fornecidas, sendo possível armazenar essas strings em um objeto, por exemplo.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>altura <span class="sc">%&gt;%</span> <span class="fu">str_subset</span>(<span class="st">"cm|centimetro"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“1 metro e 60 centimetros”</td>
<td>“191 cm”</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="str_remove-e-str_remove_all" class="level3">
<h3 class="anchored" data-anchor-id="str_remove-e-str_remove_all"><code>str_remove</code> e <code>str_remove_all</code></h3>
<p>A função <code>str_remove</code> é usada para remover padrões das strings, por exemplo, você pode desejar tirar alguma letra, algum número ou algum caractere. Essa função (mas não só ela) possui umas variante que é <code>str_remove_all</code> que basicamente funciona da mesma maneira que a primeira, porém ela vai remover TODOS os padrões dentro da mesma string e não somente a primeira possibilidade. Vamos demonstrar em um exemplo.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>altura <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"8"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“1.5”</td>
<td>“1 metro e 60 centimetros”</td>
</tr>
<tr class="even">
<td>[3]</td>
<td>“191 cm”</td>
<td>“167”</td>
</tr>
<tr class="odd">
<td>[5]</td>
<td>“1,5 metros”</td>
<td>“18”</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>altura <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">"8"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“1.5”</td>
<td>“1 metro e 60 centimetros”</td>
</tr>
<tr class="even">
<td>[3]</td>
<td>“191 cm”</td>
<td>“167”</td>
</tr>
<tr class="odd">
<td>[5]</td>
<td>“1,5 metros”</td>
<td>“1”</td>
</tr>
</tbody>
</table>
</div>
<p>Observe que ao utilizar o <code>str_remove</code>, ainda ficou um “8” no último objeto. Isso acontece basicamente porque essa função remove o padrão escolhido de todas as strings, entretando apenas o primeiro encontrado. O <code>str_remove_all</code> é uma alternativa caso queira contornar isso.</p>
</section>
<section id="str_replace-e-str_replace_all" class="level3">
<h3 class="anchored" data-anchor-id="str_replace-e-str_replace_all"><code>str_replace</code> e <code>str_replace_all</code></h3>
<p>Agora digamos que a gente não queira remover certos padrões e sim substituir por alguma outra coisa. A função <code>str_replace</code> nos auxilia nisso e assim como a <code>str_remove</code>, ela também possui a variante <code>str_replace_all</code>. Essas funções possuem 3 argumentos. Em resumo, o primeiro argumento <code>string</code> irá receber um vetor de caracteres. O segundo argumento <code>pattern</code> irá receber o padrão a ser procurado. Por fim, o terceiro argumento <code>replacement</code> recebe um vetor de caracteres de substituições e deve ter comprimento um ou o mesmo comprimento que <code>string</code> ou <code>pattern</code>. Vamos a um exemplo simples.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(altura, <span class="st">"cm|metros|centimetros"</span>, <span class="st">"cm."</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“1.85”</td>
<td>“1 metro e 60 cm.”</td>
<td>“191 cm.”</td>
<td>“167”</td>
</tr>
<tr class="even">
<td>[5]</td>
<td>“1,58 cm.”</td>
<td>“188”</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note que no último argumento eu subsitui "metros" por nada.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(altura, <span class="fu">c</span>(<span class="st">"cm"</span> <span class="ot">=</span> <span class="st">"cm1"</span>, <span class="st">"centimetros"</span> <span class="ot">=</span> <span class="st">"cm2"</span>, <span class="st">"metros"</span> <span class="ot">=</span> <span class="st">""</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“1.85”</td>
<td>“1 metro e 60 cm2.”</td>
<td>“191 cm1.”</td>
<td>“167”</td>
</tr>
<tr class="even">
<td>[5]</td>
<td>“1,58”</td>
<td>“188”</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="expressões-regulares" class="level1">
<h1>Expressões regulares</h1>
<p>Agora que já conhecemos algumas das funções do pacote <code>stringr</code>, vamos falar um pouco sobre as expressões regulares (regex). Para trabalhar com textos de uma maneira fácil, é necessário saber um pouco de regex. Elas permitem identificar conjuntos de caracteres, palavras e outros padrões por meio de uma sintaxe concisa. O pacote divide algumas “características” das expressões regulares em subgrupos, como são muitos e normalmente seguem um padrão vamos falar apenas de algumas. Você pode ter acesso a toda parte de regex através do seguinte <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf">cheat sheet</a>. Para facilitar o entendimento, após introduzir uma base das expressões regulares, vamos seguir com os exemplos práticos, exemplicando passo a passo o que está acontecendo.</p>
<section id="classes" class="level2">
<h2 class="anchored" data-anchor-id="classes">Classes</h2>
<section id="suplentes" class="level4">
<h4 class="anchored" data-anchor-id="suplentes">Suplentes</h4>
<ul>
<li><code>x|y</code> ou</li>
<li><code>[xy]</code> qualquer um de<br>
</li>
<li><code>[^xy]</code> qualquer coisa menos</li>
<li><code>x-y</code> entre</li>
</ul>
</section>
<section id="âncoras" class="level4">
<h4 class="anchored" data-anchor-id="âncoras">Âncoras</h4>
<ul>
<li><code>^x</code> começo da string</li>
<li><code>x$</code> fim da string</li>
</ul>
</section>
<section id="olhar-em-volta" class="level4">
<h4 class="anchored" data-anchor-id="olhar-em-volta">Olhar em volta</h4>
<ul>
<li><code>x(?=y)</code> seguido por</li>
<li><code>x(?!y)</code> não seguido por</li>
<li><code>(?&lt;=x)y</code> precedido por</li>
<li><code>(?&lt;!x)y</code> não precedido por</li>
</ul>
</section>
<section id="quantificadores" class="level4">
<h4 class="anchored" data-anchor-id="quantificadores">Quantificadores</h4>
<ul>
<li><code>x?</code> zero ou um</li>
<li><code>x*</code> zero ou mais</li>
<li><code>x+</code> um ou mais</li>
<li><code>x{n}</code> exatamente “n”</li>
<li><code>x{n,}</code> “n” ou mais</li>
<li><code>x{n,m}</code> entre “n” e “m”</li>
</ul>
</section>
<section id="alguns-operadores-interessantes" class="level4">
<h4 class="anchored" data-anchor-id="alguns-operadores-interessantes">Alguns operadores interessantes</h4>
<ul>
<li><p><code>\\s</code> espaço; <code>\\S</code> não espaço</p></li>
<li><p><code>\\d</code> qualquer dígito; <code>\\D</code> não dígito</p></li>
<li><p><code>\\w</code> qualquer caractere de palavra</p></li>
<li><p><code>[:lower:]</code> letra minusculas</p></li>
<li><p><code>[:upper:]</code> letras maiusculas</p></li>
<li><p><code>[:punct:]</code> pontuação</p></li>
<li><p><code>[:graph:]</code> letras, números e pontuações</p></li>
<li><p><code>.</code> qualquer coisa (caso queira usar o “.” em sua forma literal, use <code>\\.</code>)</p></li>
</ul>
</section>
</section>
<section id="exemplificando-classes-e-operadores" class="level2">
<h2 class="anchored" data-anchor-id="exemplificando-classes-e-operadores">Exemplificando classes e operadores</h2>
<p>Mostramos acima algumas classes e operadores interesserantes e que geralmente são muito utilizados. Vamos agora mostrar em alguns exemplos como eles funcionam.</p>
<p>Vamos criar então 2 vetores contendo as mesmas informações (3 modelos de carros), porém o segundo vetor terá espaços excedentes no meio das palavras. Imagino que poderíamos ter um conjunto de dados muito grande, “corrigir” um caractere por vez se tornaria improdutivo. Então, vamos pensar em uma solução para este exemplo usando regex.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>carros1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ford Mustang"</span>, <span class="st">"Chevrolet Camaro"</span>, <span class="st">"Cherry Tigo"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>carros2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Ford      Mustang"</span>, <span class="st">"Chevrolet    Camaro"</span>, <span class="st">"Cherry      Tigo"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(carros1, carros2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>FALSE</td>
</tr>
</tbody>
</table>
</div>
<p>Usamos a função <code>identical</code> para mostrar que o R reconhece que os vetores não são iguais. Para resolver esse problema, podemos usar a seguinte lógica: sabemos que o correto é haver apenas um espaço entre as palavras. Qualquer quantidade de espaços que for maior que um, iremos corrigir. Podemos fazer isso combinando regex com a função <code>str_replace_all</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>carros2 <span class="ot">&lt;-</span> carros2 <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s{2,}"</span>, <span class="st">" "</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>carros2</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“Ford Mustang”</td>
<td>“Chevrolet Camaro”</td>
<td>“Cherry Tigo”</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(carros1, carros2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
</div>
<p>Como já vimos, a função <code>str_replace_all</code> nos ajuda a fazer substiuições de caracteres. Nesse caso, a regex <code>\\s</code> significa “espaço”. O <code>{2,}</code> indica que queremos identificar algo se repita duas ou mais vezes. Então a função basicamente irá identificar toda vez que um espaço aparecer seguidamente duas ou mais vezes e vai substituir por apenas um espaço. Note que agora o identical retorna <code>true</code>, ou seja, os vetores são iguais. Lembrando que já falamos da <code>str_trim()</code> que remove espaços no começo e no fim dos caracteres, agora sabemos como tratar qualquer tipo de problema relacionado a espaços excedentes.</p>
<p>Vamos agora voltar para um vetor que já utilizamos acima. Devido a maneira com que os caracteres estão armazenadas nesse vetor, fica complicado transformar esses caracteres em informações. Ao utilizarmos expressões regulares de uma forma bem simples, já conseguimos trabalhar com essas informaçõs.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>altura</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“1.85”</td>
<td>“1 metro e 60 centimetros”</td>
</tr>
<tr class="even">
<td>[3]</td>
<td>“191 cm”</td>
<td>“167”</td>
</tr>
<tr class="odd">
<td>[5]</td>
<td>“1,58 metros”</td>
<td>“188”</td>
</tr>
</tbody>
</table>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>altura <span class="ot">&lt;-</span> altura <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>altura</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“185”</td>
<td>“160”</td>
<td>“191”</td>
<td>“167”</td>
<td>“158”</td>
<td>“188”</td>
</tr>
</tbody>
</table>
</div>
<p>Observe que ao utilizar o <code>\\D</code>, obtivemos apenas números. Sendo assim já conseguimos uniformizar a maneira com que as informações estão sendo exibidas. A partir daqui já podemos até obter algumas estatísticas descritivas, como a média por exemplo.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>altura <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(altura)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(altura)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>174.8333</td>
</tr>
</tbody>
</table>
</div>
<p>Note que para obter a média foi preciso transformar o vetor altura, originalmente da classe <code>character</code> em <code>numeric</code>.</p>
</section>
<section id="na-prática" class="level2">
<h2 class="anchored" data-anchor-id="na-prática">Na prática</h2>
<p>Vamos agora colocar em prática tudo o que vimos em um banco de dados fictício que iremos criar. Suponha que uma empresa nacional de aluguel de veículos esteja interessada em obter algumas informações. Para isso ela irá aplicar um questionário tendo como público as pessoas que já alugaram seus veículos. No questionário as pessoas deveriam passar as seguintes informações: “Marca/modelo do veículo”, “Alugaria esse veículo novamente?”, “Grau de satisfação com a empresa”, “Qual sua cidade/estado (sigla)”. Todas as variáveis do questionario foram do tipo resposta aberta, ou seja, os respondentes poderiam escrevem de qualquer maneira suas respostas. Assim gerou-se uma dificuldade em sumarizar e obter informações relevantes desse banco de dados, já nas respostas foram encontradas erros como, espaços excedentes, palavras iguais escritas de formas diferentes, discordância entre letras maiúsculas e minúsculas, entre outros.<br>
Torna-se necessário então realizar um bom tratamento nesses caracteres para que seja possível extrair todas as informações. Vamos então utilizar o queridinho <code>stringr</code> para nos ajudar.</p>
<section id="criando-o-banco-de-dados" class="level4">
<h4 class="anchored" data-anchor-id="criando-o-banco-de-dados">Criando o banco de dados</h4>
<p>Existem diferentes formas de criar um banco de dados. Para este exemplo vamos criar 4 vetores e transformá-los em um <code>data.frame</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># veículos da locadora: "Honda Civic", "Toyota Corolla", "Fiat Argo" e "Ford Fusion"</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>veiculo <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Honda  civic"</span>, <span class="st">"honda - civic"</span>, <span class="st">"  fiat Argo"</span>, <span class="st">"FORD FUSION  "</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"toyota Corolla"</span>, <span class="st">"Toyota   COROLLA"</span>, <span class="st">"Fiat  / argo"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">" HONDA civic"</span>, <span class="st">"ford fusion "</span>, <span class="st">"toyota COROLLa"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>alugaria_de_novo <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SIM"</span>, <span class="st">"Sim"</span>, <span class="st">"nao"</span>, <span class="st">"sim"</span>, <span class="st">"não"</span>, <span class="st">"NAOOO"</span>, <span class="st">"Não"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sim"</span>, <span class="st">"NÃO"</span>, <span class="st">"Nao"</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>grau_de_satisfacao <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"8.1"</span>, <span class="st">"10"</span>, <span class="st">"3,23"</span>, <span class="st">"6"</span>, <span class="st">" 5,3"</span>, <span class="st">"0,0000"</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"7.7"</span>, <span class="st">"9 "</span>, <span class="st">"5"</span>, <span class="st">"6,666"</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>cidade <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Vitória - ES"</span>, <span class="st">"sao paulo - sp"</span>, <span class="st">"Rio de Janeiro /Rj"</span>,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BELO HORIZONTE MG"</span>, <span class="st">" vitoria  Es"</span>, <span class="st">"Florianopolis / sc "</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRES CORAÇÕES - mg"</span>, <span class="st">"salvador BA"</span>, <span class="st">"São Paulo - SP"</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">" belo horizonte / mg"</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    veiculo,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    alugaria_de_novo,</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    grau_de_satisfacao,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    cidade</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dados)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 25%">
<col style="width: 28%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">veiculo</th>
<th style="text-align: left;">alugaria_de_novo</th>
<th style="text-align: left;">grau_de_satisfacao</th>
<th style="text-align: left;">cidade</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Honda civic</td>
<td style="text-align: left;">SIM</td>
<td style="text-align: left;">8.1</td>
<td style="text-align: left;">Vitória - ES</td>
</tr>
<tr class="even">
<td style="text-align: left;">honda - civic</td>
<td style="text-align: left;">Sim</td>
<td style="text-align: left;">10</td>
<td style="text-align: left;">sao paulo - sp</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fiat Argo</td>
<td style="text-align: left;">nao</td>
<td style="text-align: left;">3,23</td>
<td style="text-align: left;">Rio de Janeiro /Rj</td>
</tr>
<tr class="even">
<td style="text-align: left;">FORD FUSION</td>
<td style="text-align: left;">sim</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">BELO HORIZONTE MG</td>
</tr>
<tr class="odd">
<td style="text-align: left;">toyota Corolla</td>
<td style="text-align: left;">não</td>
<td style="text-align: left;">5,3</td>
<td style="text-align: left;">vitoria Es</td>
</tr>
<tr class="even">
<td style="text-align: left;">Toyota COROLLA</td>
<td style="text-align: left;">NAOOO</td>
<td style="text-align: left;">0,0000</td>
<td style="text-align: left;">Florianopolis / sc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fiat / argo</td>
<td style="text-align: left;">Não</td>
<td style="text-align: left;">7.7</td>
<td style="text-align: left;">TRES CORAÇÕES - mg</td>
</tr>
<tr class="even">
<td style="text-align: left;">HONDA civic</td>
<td style="text-align: left;">sim</td>
<td style="text-align: left;">9</td>
<td style="text-align: left;">salvador BA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ford fusion</td>
<td style="text-align: left;">NÃO</td>
<td style="text-align: left;">5</td>
<td style="text-align: left;">São Paulo - SP</td>
</tr>
<tr class="even">
<td style="text-align: left;">toyota COROLLa</td>
<td style="text-align: left;">Nao</td>
<td style="text-align: left;">6,666</td>
<td style="text-align: left;">belo horizonte / mg</td>
</tr>
</tbody>
</table>
</div>
<p>Assim ficou o nosso <code>data.frame</code>. Note que além dos erros visíveis, ainda temos problemas com espaços a mais antes, depois e no meio das palavras que apesar de não estar visível na apresentação da tabela, eles existem.</p>
</section>
<section id="lapidando-os-caracteres" class="level3">
<h3 class="anchored" data-anchor-id="lapidando-os-caracteres">Lapidando os caracteres</h3>
<p>Vamos fazer o nosso tratamento de dados variável por variável. Iremos mostrar maneiras diferentes de organizar essas informações, lembrando que isso pode ser feito de diversas formas.</p>
<p>Olhando para a variável “veiculo” conseguimos notar um certo padrão. Todas as observações contém a marca do veículo seguida pelo modelo. A partir daqui já podemos pensar em algumas formas de tratamento, como, criar uma variável apenas com a marca e outra com o modelo. Note que a marca e modelo são separados ou por espaço, ou por um “-” ou por “/”. Perceber padrões no seu banco de dados é interessante para o tratamento.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> dados <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">marca =</span> veiculo <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_remove</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s.+|</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">(.+|/.+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_to_upper</span>(),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">modelo =</span> veiculo <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_extract</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s.+|</span><span class="sc">\\</span><span class="st">s</span><span class="sc">\\</span><span class="st">(.+|/.+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_remove</span>(<span class="st">"[:punct:]"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_to_upper</span>(),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">marca_modelo =</span> <span class="fu">paste</span>(marca, modelo)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> dados <span class="sc">%&gt;%</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(veiculo))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Acabamos de utilizar a função <code>mutate</code> para criar 3 novas variáveis a partir da variável original (<code>veiculos</code>), sendo elas: <code>marca</code>, <code>modelo</code> e <code>marca_modelo</code>. Basicamente utilizamos as funções já mostradas ateriormente como a <code>str_trim</code> para remover os espaços antes e depois do characteres, também utilizamos o <code>str_remove</code> e <code>str_extract</code>, ambos combinados com as mesmas expressões regulares (<code>\\s.+|\\s\\(.+|/.+</code>). Em resumo essa regex detecta todo “espaço” seguido por qualquer coisa <strong>ou</strong> “espaço” seguido por um parênteses aberto seguido por qualquer coisa <strong>ou</strong> uma “/” seguida por qualquer coisa. Também utilizamos o <code>str_remove("[:punct:]")</code> e <code>str_to_upper</code> para deixar todas as letras sem acentos, maiúsculas e padronizadas. Retiramos do banco de dados a variável original <code>veiculos</code> já que se tornou inutilizável.</p>
<p>A variável <code>alugaria_de_novo</code> é do tipo binária que contém, ou pelo menos deveria conter, dois tipo de respostas: “SIM” e “NÃO”. De fato todas as respostas estão representando SIM ou NAO, entretanto, devido às diferentes maneiras com que elas foram escritas, fica difícil extrair informações. Vamos então tratar essa variável.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">$</span>alugaria_de_novo <span class="ot">&lt;-</span> dados<span class="sc">$</span>alugaria_de_novo <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"^S|s[Ii]"</span>, <span class="st">"SIM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(<span class="at">end =</span> <span class="dv">3</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">$</span>alugaria_de_novo <span class="ot">&lt;-</span> dados<span class="sc">$</span>alugaria_de_novo <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"^N|n[Aaãâ]"</span>, <span class="st">"NAO"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(<span class="at">end =</span> <span class="dv">3</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">$</span>alugaria_de_novo</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“SIM”</td>
<td>“SIM”</td>
<td>“NAO”</td>
<td>“SIM”</td>
<td>“NAO”</td>
<td>“NAO”</td>
<td>“NAO”</td>
<td>“SIM”</td>
<td>“NAO”</td>
<td>“NAO”</td>
</tr>
</tbody>
</table>
</div>
<p>Para este caso usamos o <code>str_replace</code> junto com expressões regulares para substituir palavras que representam “sim” e “não” por “SIM” e o “NAO”, respectivamente. As regex usadas para esse caso foram <code>"^S|s[Ii]"</code>, que representa “todo S ou s seguido por I ou i observado no início da string” e <code>^N|n[Aaãâ]</code> que representa “todo n ou N seguido por A, a, ã ou â”. Após isso, usamos o <code>str_sub</code> para pegar apenas as três primeiras letras. Vale ressaltar que caso outras palavras apareçam na resposta, ela não vai funcionar, nesse caso será preciso utilizar outras funções ou apenas “aprimorar” as expressões regulares utilizadas.</p>
<p>Para o grau de satisfação as pessoas deram notas de 0 a 10. Notamos que algumas pessoas separaram os números utilizando “.” e outras utilizando “,”. O R entende essa variável como <code>character</code> e pode ser interessante transformar essa variável em numérica (igual fizemos anteriormente) para realizar algumas análises quantitativas. O R não irá reconhecer como número uma variável com duas formas diferentes de separação para o dígito (“.” e “,”), por exemplo, para um vetor do tipo <code>c("3.1", "3,1")</code> é necessário padronizar essa variável utilizando o mesmo separador.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">$</span>grau_de_satisfacao <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(grau_de_satisfacao, <span class="st">"</span><span class="sc">\\</span><span class="st">,"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="dv">1</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">$</span>grau_de_satisfacao</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<tbody>
<tr class="odd">
<td>[1]</td>
<td>8.1</td>
<td>10.0</td>
<td>3.2</td>
<td>6.0</td>
<td>5.3</td>
<td>0.0</td>
<td>7.7</td>
<td>9.0</td>
<td>5.0</td>
<td>6.7</td>
</tr>
</tbody>
</table>
</div>
<p>Substituímos todas as vírgulas por pontos por meio da função <code>str_replace</code>, depois foi necessário transformar a variável em númerica, fizemos isso por meio da função <code>as.numeric</code>. Logo após, utilizamos a função <code>round</code> para arredondar os números para uma casa decimal. A parte de arredondar números pode ser interessante em diversar análises e o R possui algumas funções como <code>floor</code> e <code>ceiling</code>, além da <code>round</code>. Logo, quando estiver trabalhando com arrendondamentos pode ser interessente pesquisar sobre elas.</p>
<p>A última variável para ser tratada é a que contém as informações de cidade/estado dos respondentes. Observe que as observações tem estruturas parecidas com as da variável <code>veiculos</code>, logo um tratamento similar poderia ser útil, mas vamos fazer um pouco diferente.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">$</span>cidade <span class="ot">&lt;-</span> dados<span class="sc">$</span>cidade <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_to_upper</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_remove_all</span>(<span class="st">"[:punct:]"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    abjutils<span class="sc">::</span><span class="fu">rm_accent</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s(?=([:alpha:]){2}$)"</span>, <span class="st">" - "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s{2,}"</span>, <span class="st">" "</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">$</span>cidade</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1]</td>
<td>“VITORIA - ES”</td>
<td>“SAO PAULO - SP”</td>
<td>“RIO DE JANEIRO - RJ”</td>
</tr>
<tr class="even">
<td>[4]</td>
<td>“BELO HORIZONTE - MG”</td>
<td>“VITORIA - ES”</td>
<td>“FLORIANOPOLIS - SC”</td>
</tr>
<tr class="odd">
<td>[7]</td>
<td>“TRES CORACOES - MG”</td>
<td>“SALVADOR - BA”</td>
<td>“SAO PAULO - SP””</td>
</tr>
<tr class="even">
<td>[10]</td>
<td>“BELO HORIZONTE - MG”</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>Aqui queremos padronizar as observações para que fiquem no padrão “CIDADE - UF” então começamos removendo espaços excedentes, depois deixamos todas as letras maiúsculas e então usamos o <code>str_remove_all("[:punct:]")</code>, mesmo assim ainda restou restou alguns acentos como em <code>VITÓRIA</code>. Para corrigir isso utilizamos a função <code>rm_accent</code> do pacote <code>abjutils</code>. O último passo seria substituir os espaços que separam a cidade do UF por um “-”. Uma maneira de fazer isso seria utilizando o <code>str_replace</code>, entretanto algumas cidade possuem mais de um nome, ou seja, ao fazer essa substituição todos os espaços seriam afetados e teriamos resultados como “SAO - PAULO - SP”. Uma maneira de contornar isso (nesse caso) é usar a expressão regular <code>"\\s(?=([:alpha:]){2}$)"</code>. Essa expressão basicamente está pegando, no final da string, todo espaço seguido por exatamente 2 letras quaisquer <code>"([:alpha:])"</code>. O <code>?=</code> faz com que seja alterada apenas a entrada, nesse caso ele vai alterar apenas o espaço. Consideramos que todos os UF’s tem exatamente duas letras. Em alguns casos pode ser interessante separar em colunas diferentes o município e a cidade. Fizemos algo parecido quando tratamos a primeira variável.</p>
<p>Vamos dar uma olhada em como ficou o nosso banco de dados final</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> dados <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(marca_modelo, marca, modelo, alugaria_de_novo, cidade, grau_de_satisfacao)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dados)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 21%">
<col style="width: 22%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">marca_modelo</th>
<th style="text-align: left;">marca</th>
<th style="text-align: left;">modelo</th>
<th style="text-align: left;">alugaria_de_novo</th>
<th style="text-align: left;">cidade</th>
<th style="text-align: right;">grau_de_satisfacao</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HONDA CIVIC</td>
<td style="text-align: left;">HONDA</td>
<td style="text-align: left;">CIVIC</td>
<td style="text-align: left;">SIM</td>
<td style="text-align: left;">VITORIA - ES</td>
<td style="text-align: right;">8.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">HONDA CIVIC</td>
<td style="text-align: left;">HONDA</td>
<td style="text-align: left;">CIVIC</td>
<td style="text-align: left;">SIM</td>
<td style="text-align: left;">SAO PAULO - SP</td>
<td style="text-align: right;">10.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FIAT ARGO</td>
<td style="text-align: left;">FIAT</td>
<td style="text-align: left;">ARGO</td>
<td style="text-align: left;">NAO</td>
<td style="text-align: left;">RIO DE JANEIRO - RJ</td>
<td style="text-align: right;">3.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">FORD FUSION</td>
<td style="text-align: left;">FORD</td>
<td style="text-align: left;">FUSION</td>
<td style="text-align: left;">SIM</td>
<td style="text-align: left;">BELO HORIZONTE - MG</td>
<td style="text-align: right;">6.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TOYOTA COROLLA</td>
<td style="text-align: left;">TOYOTA</td>
<td style="text-align: left;">COROLLA</td>
<td style="text-align: left;">NAO</td>
<td style="text-align: left;">VITORIA - ES</td>
<td style="text-align: right;">5.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">TOYOTA COROLLA</td>
<td style="text-align: left;">TOYOTA</td>
<td style="text-align: left;">COROLLA</td>
<td style="text-align: left;">NAO</td>
<td style="text-align: left;">FLORIANOPOLIS - SC</td>
<td style="text-align: right;">0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FIAT ARGO</td>
<td style="text-align: left;">FIAT</td>
<td style="text-align: left;">ARGO</td>
<td style="text-align: left;">NAO</td>
<td style="text-align: left;">TRES CORACOES - MG</td>
<td style="text-align: right;">7.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">HONDA CIVIC</td>
<td style="text-align: left;">HONDA</td>
<td style="text-align: left;">CIVIC</td>
<td style="text-align: left;">SIM</td>
<td style="text-align: left;">SALVADOR - BA</td>
<td style="text-align: right;">9.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FORD FUSION</td>
<td style="text-align: left;">FORD</td>
<td style="text-align: left;">FUSION</td>
<td style="text-align: left;">NAO</td>
<td style="text-align: left;">SAO PAULO - SP</td>
<td style="text-align: right;">5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">TOYOTA COROLLA</td>
<td style="text-align: left;">TOYOTA</td>
<td style="text-align: left;">COROLLA</td>
<td style="text-align: left;">NAO</td>
<td style="text-align: left;">BELO HORIZONTE - MG</td>
<td style="text-align: right;">6.7</td>
</tr>
</tbody>
</table>
</div>
<p>Para finalizar é interessente ver que nosso tratamento de dados funcionou. Queremos saber se nossas observações estão corretamentes estruturadas, se por exemplo todas as respostas que representam a mesma coisa estão de fato iguais. Uma maneira legal de fazer isso é criar tabelas de frequência para as variáveis qualitativas e apresentar medidas resumo para as variáveis quantitativas.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">freq</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    dados<span class="sc">$</span>marca_modelo,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.last =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sort =</span> <span class="st">"inc"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Tabela de frequências para marca/modelo"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FIAT ARGO</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">FORD FUSION</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HONDA CIVIC</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: left;">TOYOTA COROLLA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
<p>Tabela de frequências para marca/modelo</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">freq</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    dados<span class="sc">$</span>cidade,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="cn">TRUE</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.last =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sort =</span> <span class="st">"inc"</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Tabela de frequências para cidade/estado"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FLORIANOPOLIS - SC</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">RIO DE JANEIRO - RJ</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SALVADOR - BA</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">TRES CORACOES - MG</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BELO HORIZONTE - MG</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">SAO PAULO - SP</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VITORIA - ES</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
<p>Tabela de frequências para cidade/estado</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>questionr<span class="sc">::</span><span class="fu">freq</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    dados<span class="sc">$</span>alugaria_de_novo,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cum =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.last =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sort =</span> <span class="st">"inc"</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Tabela de frequências para 'alugaria de novo'"</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SIM</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;">NAO</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
</div>
<p>Tabela de frequências para ‘alugaria de novo’</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dados<span class="sc">$</span>grau_de_satisfacao)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>Min.</td>
<td>1st Qu.</td>
<td>Median</td>
<td>Mean</td>
<td>3rd Qu.</td>
<td>Max.</td>
</tr>
<tr class="even">
<td>0.000</td>
<td>5.075</td>
<td>6.350</td>
<td>6.100</td>
<td>8.000</td>
<td>10.000</td>
</tr>
</tbody>
</table>
</div>
<p>Com o banco de dados prontos já é possível realizar inúmeras análises e conseguir apresentar os resultados/informações. Muitas dessas informações são passadas atráves de gráficos. O pacote <code>ggplot2</code> é um grande aliado nesse ramo, mas isso é assunto para um outro post (<em>spoiler</em>).</p>
<p>Esperamos que com esse post você possa entender um pouco mais de como tratar string’s utilizando (mas não só) o pacote <code>stringr</code> e expressões regulares. Vale ressaltar que realizar um tratamento de caracteres, inúmeros obstaculos podem surgir no caminho. É importante ter em mente que cada caso é um caso e muitas das vezes você precisará encontrar uma expressão regular que resolva aquele seu problema específico.</p>
</section>
</section>
</section>
<section id="referências" class="level1">
<h1>Referências</h1>
<p><a href="https://livro.curso-r.com/7-4-o-pacote-stringr.html" class="uri">https://livro.curso-r.com/7-4-o-pacote-stringr.html</a></p>
<p><a href="https://bookdown.org/davi_moreira/txt4cs/stringR.html" class="uri">https://bookdown.org/davi_moreira/txt4cs/stringR.html</a></p>
<p><a href="https://www.youtube.com/watch?v=ii4Pfox-3s8&amp;t=3274s" class="uri">https://www.youtube.com/watch?v=ii4Pfox-3s8&amp;t=3274s</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><br>Copyright © 2024 | Made by <a href="https://www.josecarlosinfo.com/"> Jose C. S. Junior</a> | Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>