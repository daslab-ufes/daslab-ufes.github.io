<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bruno Santos">
<meta name="description" content="Para analisar variações e resultados de informações, os mapas são ferramentas essenciais. Este post aborda como utilizar ferramentas do R para apresentar dados através de mapas.">

<title>Utilizando mapas para mostrar estatísticas importantes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<link href="../..//img/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(banner.png);
background-size: cover;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/daslab-logo-removebg.png" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Alternar de navegação" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../sobre/index.html" rel="" target="">
 <span class="menu-text">Sobre</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projetos/index.html" rel="" target="">
 <span class="menu-text">Projetos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutoriais/index.html" rel="" target="">
 <span class="menu-text">Tutoriais</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ensinar/index.html" rel="" target="">
 <span class="menu-text">ensinaR</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../oobr/index.html" rel="" target="">
 <span class="menu-text">OOBr</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../eventos/index.html" rel="" target="">
 <span class="menu-text">Eventos</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contato/index.html" rel="" target="">
 <span class="menu-text">Contato</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Utilizando mapas para mostrar estatísticas importantes</h1>
                  <div>
        <div class="description">
          Para analisar variações e resultados de informações, os mapas são ferramentas essenciais. Este post aborda como utilizar ferramentas do R para apresentar dados através de mapas.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">DataViz</div>
                <div class="quarto-category">ggplot</div>
                <div class="quarto-category">Data Wrangling</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Estatística</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor</div>
      <div class="quarto-title-meta-contents">
               <p>Bruno Santos </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Data de Publicação</div>
      <div class="quarto-title-meta-contents">
        <p class="date">15 de janeiro de 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<style>
body {
    background: white;
}

.quarto-title-banner{
    text-align: left !important;
}
</style>
<p>Para diversas informações, podemos analisar a sua variação, ou os seus resultados basicamente, com a ajuda de mapas. Por exemplo, podemos observar a população do Brasil por municípios para perceber quais regiões são mais povodas ou mais populosas. Podemos estudar ainda outras informações por município, como Índice de Desenvolvimento Humano (IDH) e taxas de desemprego para entender quais regiões estão mais desenvolvidas ou quais passam por maiores problemas econômicos, respectivamente. Observar esse tipo de informação em mapas é importante porque muitas vezes essas variáveis são correlacionadas espacialmente e o mapa pode nos ajudar a entender essa relação.</p>
<p>Com isso em mente, hoje vamos mostrar como utilizar alguns pacotes do <code>R</code> para apresentar informações em mapas.</p>
<p>Primeiramente, carregando alguns pacote de interesse:</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># fazer gráficos</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal) <span class="co"># ler arquivos de mapas</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># fazer manipulação de banco de dados</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet) <span class="co"># gráficos com mapas interativos.</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Inicialmente, precisamos fazer o <em>download</em> da malha municipal, que é definida pelo IBGE da seguinte maneira</p>
<blockquote class="blockquote">
<p>A Malha Municipal retrata a situação vigente da Divisão Político Administrativa (DPA), através da representação vetorial das linhas definidoras das divisas estaduais e limites municipais, utilizada na coleta dos Censos Demográficos e demais pesquisas do IBGE.</p>
</blockquote>
<p>Esses arquivos também são conhecidos como <em>shapefiles</em> e serão a base de nossos mapas. É possível baixar os arquivos relativos a todo Brasil no seguinte <a href="https://www.ibge.gov.br/geociencias/organizacao-do-territorio/15774-malhas.html?=&amp;t=downloads">link</a>. Em consulta feita em dezembro de 2020, o nome do arquivo a ser baixado era <code>br_municipios_20200807.zip</code>.</p>
<p>Ao baixar essa pasta com todos os municípios, você deve descompactar o arquivo e salvar essa pasta em algum caminho de sua preferência. Para facilitar, deixe salvo em um objeto esse caminho. Por exemplo, faça</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>caminho_mapas <span class="ot">&lt;-</span> <span class="st">"Coloque o caminho da pasta aqui."</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note que dentro dessa pasta existem vários arquivos de diferentes formatos, todos com o nome <code>BR_Municipios_2019</code>. Não se preocupe com qual arquivo vamos utilizar por enquanto. Para ler os arquivos utilize a função <code>readOGR</code> do pacote <code>rgdal</code>. Note que é possível fazer o <code>plot</code> do objeto criado</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mapa_brasil <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">dsn =</span> caminho_mapas,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">layer =</span> <span class="st">"BR_Municipios_2019"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mapa_brasil)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- GRAFICO ESTÁ FALTANDO -->
<!-- <center>
![](mapas_da_estatistica_files/figure-gfm/unnamed-chunk-3-1.png)
</center> -->
<p>Note porém que esse gráfico não é muito interessante devido a sua resolução, pois a quantidade de linhas perto da costa dificulta a sua visualização. Vamos mostrar como podemos ir melhorando esse mapa.</p>
<p>Primeiramente, podemos avaliar quantos objetos ou municípios são apresentados fazendo</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mapa_brasil<span class="sc">$</span>SIGLA_UF <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">tabyl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">.</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">percent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AC</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.0039483</td>
</tr>
<tr class="even">
<td style="text-align: left;">AL</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">0.0183058</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AM</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">0.0111271</td>
</tr>
<tr class="even">
<td style="text-align: left;">AP</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0.0028715</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BA</td>
<td style="text-align: right;">417</td>
<td style="text-align: right;">0.0748385</td>
</tr>
<tr class="even">
<td style="text-align: left;">CE</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">0.0330223</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DF</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0001795</td>
</tr>
<tr class="even">
<td style="text-align: left;">ES</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">0.0139986</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GO</td>
<td style="text-align: right;">246</td>
<td style="text-align: right;">0.0441493</td>
</tr>
<tr class="even">
<td style="text-align: left;">MA</td>
<td style="text-align: right;">217</td>
<td style="text-align: right;">0.0389447</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MG</td>
<td style="text-align: right;">853</td>
<td style="text-align: right;">0.1530869</td>
</tr>
<tr class="even">
<td style="text-align: left;">MS</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">0.0141780</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MT</td>
<td style="text-align: right;">141</td>
<td style="text-align: right;">0.0253051</td>
</tr>
<tr class="even">
<td style="text-align: left;">PA</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">0.0258435</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PB</td>
<td style="text-align: right;">223</td>
<td style="text-align: right;">0.0400215</td>
</tr>
<tr class="even">
<td style="text-align: left;">PE</td>
<td style="text-align: right;">185</td>
<td style="text-align: right;">0.0332017</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PI</td>
<td style="text-align: right;">224</td>
<td style="text-align: right;">0.0402010</td>
</tr>
<tr class="even">
<td style="text-align: left;">PR</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">0.0716080</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RJ</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">0.0165111</td>
</tr>
<tr class="even">
<td style="text-align: left;">RN</td>
<td style="text-align: right;">167</td>
<td style="text-align: right;">0.0299713</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RO</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">0.0093324</td>
</tr>
<tr class="even">
<td style="text-align: left;">RR</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0.0026920</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RS</td>
<td style="text-align: right;">499</td>
<td style="text-align: right;">0.0895549</td>
</tr>
<tr class="even">
<td style="text-align: left;">SC</td>
<td style="text-align: right;">295</td>
<td style="text-align: right;">0.0529433</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SE</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">0.0134602</td>
</tr>
<tr class="even">
<td style="text-align: left;">SP</td>
<td style="text-align: right;">645</td>
<td style="text-align: right;">0.1157574</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TO</td>
<td style="text-align: right;">139</td>
<td style="text-align: right;">0.0249462</td>
</tr>
</tbody>
</table>
</div>
<p>Veja como Minas Gerais é o Estado com maior número de municípios com 853 no total. E tirando o DF, os Estados com menor número de municípios são do Norte com Roraima, Amapá e Acre apresentando apenas 15, 16 e 22 municípios, respectivamente.</p>
<p>A título de curiosidade apenas, podemos fazer o mapa de apenas um estado em particular da seguinte forma</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(mapa_brasil, SIGLA_UF <span class="sc">==</span> <span class="st">"ES"</span>) <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- GRAFICO ESTÁ FALTANDO -->
<!-- <center>
![](mapas_da_estatistica_files/figure-gfm/unnamed-chunk-5-1.png)
</center> -->
<p>A título de curiosidade, o mapa do Espírito Santo não tem um erro e aquele ponto ao extremo leste são as ilhas <a href="https://pt.wikipedia.org/wiki/Trindade_e_Martim_Vaz">Trindade e Martim Vaz</a>, que fazem parte do território capixaba.</p>
<p>Continuando, podemos usar o <code>ggplot2</code> para melhorar nossos gráficos. Por exemplo, podemos utilizar os dados de população do Estado do Espírito Santo, que podem ser obtidos em <a href="https://www.ibge.gov.br/cidades-e-estados/es/" class="uri">https://www.ibge.gov.br/cidades-e-estados/es/</a> e fazer o gráfico dessa informação. Os dados do ES foram salvos no objeto <code>dados_es</code> e uma parte das informações disponíveis pode ser vista a seguir:</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dados_es)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="a-tibble-6-x-13" class="level4">
<h4 class="anchored" data-anchor-id="a-tibble-6-x-13">A tibble: 6 x 13</h4>
<div class="table-responsive">
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Município</th>
<th>Código</th>
<th>Gentílico</th>
<th>Prefeito [2017…</th>
<th>Área Territori…</th>
<th>População esti…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><chr></chr></td>
<td><dbl></dbl></td>
<td><chr></chr></td>
<td><chr></chr></td>
<td><dbl></dbl></td>
<td><dbl></dbl></td>
</tr>
<tr class="even">
<td>1</td>
<td>Afonso C…</td>
<td>3.20e6</td>
<td>afonso-c…</td>
<td>EDÉLIO FRANCISC…</td>
<td>941.</td>
<td>30455</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Águia Br…</td>
<td>3.20e6</td>
<td>aguiabra…</td>
<td>ANGELO ANTONIO …</td>
<td>454.</td>
<td>9631</td>
</tr>
<tr class="even">
<td>3</td>
<td>Água Doc…</td>
<td>3.20e6</td>
<td>água-doc…</td>
<td>PAULO MARCIO LE…</td>
<td>474.</td>
<td>10909</td>
</tr>
<tr class="odd">
<td>4</td>
<td>Alegre</td>
<td>3.20e6</td>
<td>alegrense</td>
<td>JOSÉ GUILHERME …</td>
<td>757.</td>
<td>29975</td>
</tr>
<tr class="even">
<td>5</td>
<td>Alfredo …</td>
<td>3.20e6</td>
<td>alfreden…</td>
<td>FERNANDO VIDEIR…</td>
<td>616.</td>
<td>14636</td>
</tr>
<tr class="odd">
<td>6</td>
<td>Alto Rio…</td>
<td>3.20e6</td>
<td>alto-rio…</td>
<td>LUIZ AMÉRICO BO…</td>
<td>228.</td>
<td>7874</td>
</tr>
</tbody>
</table>
</div>
<p><em> … with 7 more variables: <code>Densidade demográfica - hab/km² [2010]</code> <dbl>, <code>Escolarização &lt;span&gt;6 a 14 anos&lt;/span&gt; - % [2010]</code> <dbl>, <code>IDHM &lt;span&gt;Índice de desenvolvimento humano municipal&lt;/span&gt; [2010]</code> <dbl>, <code>Mortalidade infantil - óbitos por mil nascidos vivos [2017]</code> <dbl>, <code>Receitas realizadas - R$ (×1000) [2017]</code> <dbl>, <code>Despesas empenhadas - R$ (×1000) [2017]</code> <dbl>, <code>PIB per capita - R$ [2018]</code> <dbl> </dbl></dbl></dbl></dbl></dbl></dbl></dbl></em></p>
<p>Note porém que os nomes dos municipios contém acentos e por isso vamos utilizar uma função para retirar esses caracteres especias para fazer o cruzamento com a base dos mapas. Tal tratamento é comum para evitar erros de cruzamento, em que um município está com um nome escrito de uma forma em uma base e está escrito diferente na outra base.</p>
<p>Vamos fazer essas alterações nos dois bancos de dados, com a ajuda da função <code>iconv</code> do pacote <code>base</code> do <code>R</code>.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># salvando somente informação do ES.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mapa_es <span class="ot">&lt;-</span> <span class="fu">subset</span>(mapa_brasil, SIGLA_UF <span class="sc">==</span> <span class="st">"ES"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># criando variavel municipio no objeto mapa_es@data, com todas letras maiúsculas</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>mapa_es<span class="sc">@</span>data<span class="sc">$</span>municipio <span class="ot">&lt;-</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">iconv</span>(mapa_es<span class="sc">@</span>data<span class="sc">$</span>NM_MUN, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">toupper</span>()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># alterando nome das variaveis em dados_es</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>dados_es <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(dados_es)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>dados_es<span class="sc">$</span>municipio <span class="ot">&lt;-</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">iconv</span>(dados_es<span class="sc">$</span>municipio, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"ASCII//TRANSLIT"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">toupper</span>()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Podemos checar se todos os municipios da base de dados estão nos dois bancos utilizando a função <code>anti_join</code>.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>municipios_nao_encontrados <span class="ot">&lt;-</span> mapa_es<span class="sc">@</span>data <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">anti_join</span>(dados_es) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(municipio)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>municipios_nao_encontrados</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table-responsive">
<table class="table">
<tbody>
<tr class="odd">
<td>[1] municipio</td>
</tr>
<tr class="even">
<td>&lt;0 rows&gt; (or 0-length row.names)</td>
</tr>
</tbody>
</table>
</div>
<p>Como o resultado não retornou nenhum dado, significa que todos os valores do banco de dados <code>mapa_es@data</code> foram encontrados no banco de dados <code>dados_es</code>.</p>
<p>Podemos fazer a fusão dos dois bancos de dados, usando a função <code>left_join</code> para manter a nossa base de dados nos mapas intacta. Mais sobre fusão de bases em posts aqui no futuro!</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mapa_es<span class="sc">@</span>data <span class="ot">&lt;-</span> mapa_es<span class="sc">@</span>data <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(dados_es)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Para usar os gráficos do <code>ggplot2</code> devemos transformar o objeto <code>mapa_es</code> que é inicialmente da classe <code>SpatialPolygonsDataFrame</code>. Podemos fazer isso da seguinte forma:</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># criando uma variável identificadora de cada municipio</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mapa_es<span class="sc">@</span>data<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(mapa_es<span class="sc">@</span>data)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># criando uma base de dados a partir do objeto mapa_es</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>mapa_es_pontos <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">fortify</span>(mapa_es, <span class="at">region =</span> <span class="st">"id"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fazendo a junção desses pontos com todas as informações em mapa_es@data</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>mapa_es_df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(mapa_es_pontos,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    mapa_es<span class="sc">@</span>data,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"id"</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Retirando ilhas de Trindade e Martim Vaz</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>mapa_es_df <span class="ot">&lt;-</span> mapa_es_df <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(long <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">36</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mapa_es_df) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> populacao_estimada_pessoas_2020</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(long, lat, <span class="at">group =</span> group), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(<span class="st">"População estimada em 2020"</span>) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- GRAFICO ESTÁ FALTANDO -->
<!-- <center>
![](mapas_da_estatistica_files/figure-gfm/unnamed-chunk-12-1.png)
</center> -->
<p>Para diminuir a diferença entre os municípios da região da Grande Vitória para os demais, poderíamos fazer o gráfico com a escala logarítmica também.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mapa_es_df) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="fu">log</span>(populacao_estimada_pessoas_2020)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(long, lat, <span class="at">group =</span> group), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(<span class="st">"Log(população estimada) em 2020"</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- GRAFICO ESTÁ FALTANDO -->
<!-- <center>
![](mapas_da_estatistica_files/figure-gfm/unnamed-chunk-13-1.png)
</center> -->
<p>De maneira geral, nota-se uma grande diferença entre a população em torno da capital Vitória, com os municípios de Serra, Vila Velha e Cariacica com grande destaque. Note que se tivéssemos a informação da população ao longo dos anos poderíamos fazer uma animação da evolução da população ao longo do tempo, conforme explicado em <a href="https://daslab-ufes.github.io/estatistica_animada/">post anterior</a> sobre animações.</p>
<p>Outra informação disponível nesse banco de dados é a mortalidade infantil. O seu gráfico ficaria da seguinte forma, alterando a cor das linhas das divisas entre os municipios para cinza.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mapa_es_df) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> long,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> lat,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> group,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            mortalidade_infantil_obitos_por_mil_nascidos_vivos_2017</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_path</span>(<span class="fu">aes</span>(long, lat, <span class="at">group =</span> group), <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(<span class="st">"Mortalidade infantil </span><span class="sc">\n</span><span class="st"> Óbitos por mil nascidos (2017)"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- GRAFICO ESTÁ FALTANDO -->
<!-- <center>
![](mapas_da_estatistica_files/figure-gfm/unnamed-chunk-14-1.png)
</center> -->
<p>Para esse gráfico não parece haver uma correlação espacial muito forte, pois não observamos nenhum tipo de padrão muito forte, com exceção de uma taxa de mortalidade maior em alguns municípios no noroeste do Estado.</p>
<p>Esses gráficos com o ggplot apresentam uma melhoria com relação ao <code>plot</code> feito de forma direta no objeto da classe <code>SpatialPolygonsDataFrame</code>, porém ainda não temos que recorrer ao banco de dados para saber qual é aquel município com maior taxa de mortalidade infantil.</p>
<p>Uma alternativa é construir mapas com a ajuda do pacote <code>leaflet</code>, que produz gráficos interativos que ajudam a entender a informação de maneira direta. Antes de tudo precisamos fazer uma alteração no sistema de coordenadas de latitude e longitude usando a função <code>spTransform</code>.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformando o formato de latitude e longitude</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>es_ll <span class="ot">&lt;-</span> <span class="fu">spTransform</span>(mapa_es, <span class="fu">CRS</span>(<span class="st">"+init=epsg:4326"</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Primeiramente, podemos selecionar quais informações gostaríamos de apresentar quando passarmos o mouse por cima de cada município. Para isso, vamos criar o objeto <code>texto</code> da seguinte forma.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alterando nome das variáveis.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>es_ll<span class="sc">@</span>data <span class="ot">&lt;-</span> es_ll<span class="sc">@</span>data <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop_estimada =</span> populacao_estimada_pessoas_2020,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">mort_infantil =</span> mortalidade_infantil_obitos_por_mil_nascidos_vivos_2017,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">pib_percapita =</span> pib_per_capita_r_2018,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">idhm =</span> idhm_span_indice_de_desenvolvimento_humano_municipal_span_2010</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>texto <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Municipio: "</span>, es_ll<span class="sc">@</span>data<span class="sc">$</span>municipio, <span class="st">"&lt;br/&gt;"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"População estimada (2020): "</span>, es_ll<span class="sc">@</span>data<span class="sc">$</span>pop_estimada, <span class="st">"&lt;br/&gt;"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mortalidade infantil (2017): "</span>, es_ll<span class="sc">@</span>data<span class="sc">$</span>mort_infantil, <span class="st">"&lt;br/&gt;"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PIB per capita (2018): "</span>, es_ll<span class="sc">@</span>data<span class="sc">$</span>pib_percapita, <span class="st">"&lt;br/&gt;"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"IDHM: "</span>, es_ll<span class="sc">@</span>data<span class="sc">$</span>letalidade, <span class="st">"&lt;br/&gt;"</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(htmltools<span class="sc">::</span>HTML)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Depois, podemos criar a paleta de cores que o pacote leaflet vai usar de acordo com a variável que gostaríamos de plotar. Vamos considerar a título de demonstração a variável mortalidade.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>minha_paleta <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"viridis"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">domain =</span> es_ll<span class="sc">@</span>data<span class="sc">$</span>mort_infantil,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.color =</span> <span class="st">"transparent"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Em seguida, podemos fazer o gráfico utilizando o <code>leaflet</code> da seguinte maneira.</p>
<div class="cell">
<details open="">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setView</span>(<span class="at">lat =</span> <span class="sc">-</span><span class="fl">19.6</span>, <span class="at">lng =</span> <span class="sc">-</span><span class="fl">40.97</span>, <span class="at">zoom =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addPolygons</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> es_ll,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">fillColor =</span> <span class="sc">~</span> <span class="fu">minha_paleta</span>(mort_infantil),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">stroke =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"white"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">weight =</span> <span class="fl">0.3</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> texto,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">labelOptions =</span> <span class="fu">labelOptions</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="fu">list</span>(<span class="st">"font-weight"</span> <span class="ot">=</span> <span class="st">"normal"</span>, <span class="at">padding =</span> <span class="st">"3px 8px"</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">textsize =</span> <span class="st">"13px"</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">direction =</span> <span class="st">"auto"</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLegend</span>(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> es_ll,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">pal =</span> minha_paleta,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="sc">~</span>mort_infantil,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Mort. infantil"</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">position =</span> <span class="st">"bottomleft"</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<object class="leaflet html-widget" style="width:550px;height:480px;" data="/assets/files/graf_es.html">
</object>
<!-- <p>&nbsp;</p><p>&nbsp;</p>
<p>&nbsp;</p><p>&nbsp;</p>
<p>&nbsp;</p><p>&nbsp;</p>
<p>&nbsp;</p><p>&nbsp;</p>
<p>&nbsp;</p> -->
<p>Agora podemos passar o cursor por cima dos municípios e descobrir, por exemplo, que o município com alta taxa de mortalidade se chama Ponto Belo e tem população estimada em cerca de 27 mil pessoas. Note também que é possível fazer <em>zoom</em> no gráfico, o que pode ser importante se fizermos um gráfico de uma região muito grande.</p>
<p>Diversas opções da função <code>addPolygons</code> não foram discutidas aqui, porém deixamos para cada pessoa <em>brincar</em> com essas opções e ver o resultado para checar o que pode ser mais interessante. Deixamos esses valores segundo exemplos em que já testamos essas configurações e elas apresentaram resultados razoáveis.</p>
<p>De maneira geral, qualquer informação que possa ser representada por um <em>shapefile</em> pode ser analisada em gráficos como fizemos aqui. Por exemplo, considerando a separação por bairros na cidade de Vitória, o Observatório Capixaba da COVID-19 nas Favelas (OCOFA) analisa dados de letalidade na pandemia do novo coronavirus nos diferentes bairros. Exemplos podem ser vistos <a href="http://ocofa.org/mapas.html">aqui</a>. Além disso, ao invés de considerar a informação por municípios, também poderíamos fazer mapas com as divisões por estados.</p>
<p>Esperamos que tenham gostado de aprender como apresentar estatísticas em formas de mapas e continuaremos escrevendo sobre outros assuntos relevantes aqui no blog.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center"><br>Copyright © 2024 | Made by <a href="https://www.josecarlosinfo.com/"> Jose C. S. Junior</a> | Built with <a href="https://quarto.org/">Quarto</a></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>